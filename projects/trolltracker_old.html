<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Troll Tracker</title>
  <link rel="stylesheet" href="../style.css" />
  <style>
    .troll-list {
      margin-top: 20px;
    }

    .troll {
      padding: 10px;
      background: #eee;
      margin: 5px 0;
      border-radius: 5px;
    }

    .no-trolls {
      font-style: italic;
      color: #888;
    }

    .popup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }

    .popup-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 300px;
    }

    .popup-content input,
    .popup-content textarea {
      width: 100%;
      margin: 5px 0;
      padding: 5px;
    }

    .popup-content button {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <button class="toggle-btn" onclick="toggleSidebar()">‚ò∞</button>
    <div class="nav-links" id="navLinks">
      <a href="../index.html">üè† Home</a>
      <a href="trolltracker.html">üßô Troll Tracker</a>
      <a href="project2.html">üß™ Project 2</a>
      <a href="#">üì¨ Contact</a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content" id="mainContent">

    <header>
      <h1>üßô Troll Tracker</h1>
    </header>

    <section>

      <button onclick="openPopup()">Add Troll</button>

      <input
      type="text"
      id="searchInput"
      placeholder="Search trolls..."
      oninput="searchTrolls()"
      style="margin-top: 1rem; padding: 8px; width: 100%; max-width: 400px;"
      />

      <div class="troll-list" id="trollList"></div>
    </section>

    <footer>
      <p>¬© 2025 Niklas Edstrom</p>
    </footer>
  </div>

  <!-- Popup Form -->
  <div class="popup" id="popup">
    <div class="popup-content">
      <h2>Add Troll</h2>
      <input type="text" id="trollName" placeholder="Troll name" />
      <textarea id="trollInfo" placeholder="Troll description"></textarea>
      <button onclick="addTroll()">Add</button>
      <button onclick="closePopup()">Cancel</button>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    const TROLLS_PER_LOAD = 5;
    let trollIndex = 0;
    let trollData = [];

    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("expanded");
      document.getElementById("navLinks").classList.toggle("show");
      document.getElementById("mainContent").classList.toggle("shifted");
    }

    function openPopup() {
      document.getElementById("popup").style.display = "flex";
    }

    function closePopup() {
      document.getElementById("popup").style.display = "none";
    }

    function saveTrolls() {
      localStorage.setItem("trolls", JSON.stringify(trollData));
    }

    function loadStoredTrolls() {
      const stored = localStorage.getItem("trolls");
      trollData = stored ? JSON.parse(stored) : [];
    }

    function renderNextTrolls() {
      const list = document.getElementById("trollList");
      const nextTrolls = trollData.slice(trollIndex, trollIndex + TROLLS_PER_LOAD);

      nextTrolls.forEach((troll) => {
        const div = document.createElement("div");
        div.classList.add("troll");
        div.innerHTML = `<strong>${troll.name}</strong><p>${troll.info}</p>`;
        list.appendChild(div);
      });

      trollIndex += TROLLS_PER_LOAD;
    }

    function addTroll() {
      const name = document.getElementById("trollName").value.trim();
      const info = document.getElementById("trollInfo").value.trim();
      const list = document.getElementById("trollList");

      if (!name) return alert("Please enter a name for the troll!");

      const emptyMsg = list.querySelector(".no-trolls");
      if (emptyMsg) emptyMsg.remove();

      const troll = { name, info };
      trollData.push(troll);
      saveTrolls();

      const div = document.createElement("div");
      div.classList.add("troll");
      div.innerHTML = `<strong>${troll.name}</strong><p>${troll.info}</p>`;
      list.appendChild(div);

      closePopup();
      document.getElementById("trollName").value = "";
      document.getElementById("trollInfo").value = "";
    }

    function handleScroll() {
      const list = document.getElementById("trollList");
      const bottom = list.getBoundingClientRect().bottom;
      const viewHeight = window.innerHeight;

      if (bottom < viewHeight + 100) {
        renderNextTrolls();
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const list = document.getElementById("trollList");
      loadStoredTrolls();

      if (trollData.length === 0) {
        const msg = document.createElement("p");
        msg.textContent = "No trolls added yet.";
        msg.classList.add("no-trolls");
        list.appendChild(msg);
      } else {
        renderNextTrolls();
        window.addEventListener("scroll", handleScroll);
      }
    });
  </script>
</body>
</html>
